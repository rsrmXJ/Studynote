# ZigBee 无线传感器网络

##### 1\. 什么是物联网？

物联网（The Internet of Things，简称 IOT），是指通过各种信息传感器、二维码识读设备、射频识别技术、红外感应器、全球定位系统、激光扫描器等各种装置与技术，实时采集任何需要监控、  连接、互动的物体或过程，采集其声、光、热、电、力学、化 学、生物、位置等各种需要的信息，通过约定协议，把任何物体和互联网相连接，实现信息交换和通信，实现物与物、物与人的泛在连接，实现对物品和过程的智能化感知、识别和管理。

物联网的概念包含两层意思:

① 物联网的核心和基础仍然是互联网，它是在互联网基础上延申和拓展网络。

② 其用户端扩展到了物体与物体之间，进行信息交换和通信。

简而言之物联网就是 ”物物相连的互联网“，在这个网络上，物体之间能够彼此进行交流，无需人工干预

##### 2\. 物联网应用领域

- 智能工业
- 智能物流
- 智能交通
- 智能电网
- 智能医疗
- 智能农业
- 智能环保
- 智能家居

##### 3\. 从技术架构上物联网可以分为 3 层：

- 感知层：位于最低层，识别和获取信息。
- 网络层：位于中间层，将识别和获取的信息实时准确的发送出去
- 应用层：位于最顶层，与具体的需求相结合，对感知层获取的信息进行处理，实现智能识别、定位、跟踪、监控和管理等实际功能。

 感知层是物联网发展和应用的基础，解决的是人类世界和物理世界的数据获取问题。包含了数据采集和数据短距离传输两个阶段。

> 感知层涉及的关键技术主要包括传感器技术、物品识别技术（条形码、二维码、RFID）、短距离无线通技术（WI-FI、蓝牙、ZigBee 等）
> 

##### 4\. 无线传感器网络

无线传感器网络(Wireless Sensor Networks, WSN)，是由部署在检测区域内大量的传感器节通过无线通信方式完成的自组织网络，其目的是感知、采集和处理网络覆盖区域中被感知对象的信息，并发送给观察者。

无线传感器网络的三个要素：

① 传感器
② 被感知对象
③ 观察者

三个要素之间通过无线网络建立通信路径，协作的感知、采集、处理和发布感知信息

tips： 传感器节点：具有端节点和路由的功能。

特点: 无中心、分布控制、和多跳传输等特点、集成了检测、控制、无线通信等功能。

低复杂度、自组织、低功耗、低数据速率等特性

##### 5\. ZigBee 技术 

ZigBee 是 ZigBee 联网基于 IEEE 802.15.4 无线标准研发的一中近距离、低复杂度、低功耗、低速率、低成本的组网，安全和应用软件方面的无线技术。

3 个可使用的 ISM 频段:

- 868MHz（欧洲适用：1 个信道，20 Kbps 的传输速率
- 915MHz (北美使用)：10 个信道，信道中心间隔为 2MHz, 40 Kbps 的传输速率
- 2.4GHz (全球通用)： 16 个信道，信道中心间隔为 5MHz, 250 Kbps 的传输速率

> ISM 频段是指开放给工业、医疗和科学使用的频段，免费使用，无需授权许可，只需遵守一定的协发射功率，并且不要对其他频段造成干扰即可。

特点:

- 功耗低
- 成本低
- 时延短
- 可靠性高
- 安全性高
- 有效范围小
- 网络容量大
- 工作频段灵活
- 数据传输速率低

##### 6\. ZigBee 的技术应用：

- 智慧农业
- 智能触摸面板0
- 智能家居
- 无线温湿度传感器
- 无线插排
- 无线智能灯
- PC 外围设备
- 个人健康监护

7\. CC2530 芯片

CC2530 是 TI 公司开发的一款 ZigBee   片上系统解决方案。

- 8051 内核

命名：F 后面的是闪存空间，单位 KB 例如 CC2530F256

CC2530芯片共有40个引脚：

<img src="CC2430arti.png">

- 21 个数字 I/O 引脚 
  - 可以设置为通用 I/O或外设 IO
  - 输入口具备上拉或下拉能力
  - 具有外部中断能力
- 6 个 2 V～3.6 V模拟电源引脚（AVDD1～AVDD6）
- 2 个 2 V～3.6 V数字电源引脚（DVDD1～DVDD2）
- 1 个 1.8 V内部数字电源引脚（DCOUPL）
- 4 个 GND 引脚（GND 为接地引脚）
- 2 个射频天线输入输出引脚（RF_N和RF_P）
- 2 个 32 MHz外部晶振引脚（XOSC_Q1 和 XOSC_Q2）
- 1 个数字输入复位引脚（RESET_N）
-  1 个模拟 I/O 参考电流的外部精密偏置电阻引脚（RBIAS1）

##### 7\. 通用 I/O

当用作通用 I/O 时，引脚可以组成 3 个 8 位端口，端口 0、端口 1和端口 2表示为 P0、P1 和P2。其中，P0 和 P1是完全的8位端口，而 P2 仅有 5 位可用。所有的端口均可以位寻址，或通过特殊功能寄存器由 P0、P1 和 P2 字节寻址。每个端口引脚都可以单独设置为通用 I/O 或外部设备 I/O。

除了两个高驱动输出口P1.0和P1.1各具备20 mA的输出驱动能力之外，所有的输出口均具备4 mA的驱动能力。

寄存器 **PxSEL**（其中x为端口的标号0～2）用来设置每个端口引脚为通用I/O或者是外部设备I/O信号。作为缺省的情况，每当复位之后，所有的数字输入/输出引脚都设置为通用输入引脚。（即通用 IO 置 0，外设 IO 置 1 ）

寄存器PxDIR来设置每个端口引脚为输入或输出。只要设置PxDIR中的指定位为1，其对应的引脚口就被设置为输出了。反之置为 0 就是输入了。

##### 8\. 通用 I/O  中断

通用I/O引脚设置为输入后，可以用于产生中断。中断可以设置在外部信号的上升或下降沿触发。P0、P1和P2端口都有中断使能位，对位于IEN1和IEN2寄存器内的端口所有的位都是公共的，如下

- IEN1.P0IE：P0中断使能。
- IEN2.P1IE：P1中断使能。
- IEN2.P2IE：P2中断使能。

除了这些公共中断使能外，每     个端口的位都有位于SFR寄存器P0IEN、P1IEN和P2IEN的单独的中断使能。即使配置为外设I/O或通用输出的I/O引脚使能时都有中断产生。

当中断条件发生在任意一个I/O引脚上，P0-P2中断标志寄存器中相应的中断状态标志P0IFG、P1IFG或P2IFG将被置为1。不管引脚是否设置了它的中断使能位，中断状态标志都被设置。当中断已经执行，中断状态标志被清除，该标志写入0。这个标志必须在清除CPU端口中断标志（PxIF）之前被清除。

##### 9. 通用数字 I/O 接口控制

- P0：端口0。
- P1：端口1。
- P2：端口2。
- PERCFG：外设控制寄存器。
- APCFG：模拟外设I/O配置。
- P0SEL：端口0功能选择寄存器。
- pP1SEL：端口1功能选择寄存器。
- P2SEL：端口2功能选择寄存器。
- P0DIR：端口0方向寄存器。
- P1DIR：端口1方向寄存器。
- P2DIR：端口2方向寄存器。
- P0INP：端口0输入模式寄存器。
- P1INP：端口1输入模式寄存器。
- P2INP：端口2输入模式寄存器。
- P0IFG：端口0中断状态标志寄存器。
- P1IFG：端口1中断状态标志寄存器。
- P2IFG：端口2中断状态标志寄存器。
- PICTL：中断边缘寄存器。
- P0IEN：端口0中断掩码寄存器。
- P1IEN：端口1中断掩码寄存器。
- P2IEN：端口2中断掩码寄存器。
- PMUX：掉电信号Mux寄存器。
- OBSSEL0：观察输出控制寄存器0。
- OBSSEL1：观察输出控制寄存器1。
- OBSSEL2：观察输出控制寄存器2。
- OBSSEL3：观察输出控制寄存器3。
- OBSSEL4：观察输出控制寄存器4。
- OBSSEL5：观察输出控制寄存器5。

10\. 时钟

CC2530设备有一个内部系统时钟（或称为主时钟）。该系统时钟的源既可以用16 MHz RC振荡器（内部RC），也可以采用32 MHz晶体振荡器（外部晶振）。时钟的控制可以通过配置CLKCONCMD SFR寄存器执行。

CC2530设备有一个内部系统时钟（或称为主时钟）。该系统时钟的源既可以用16 MHz RC振荡器（内部RC），也可以采用32 MHz晶体振荡器（外部晶振）。时钟的控制可以通过配置CLKCONCMD SFR寄存器执行。

设备的振荡器可以选择高精度的晶体振荡器，也可以选择低功耗的高频RC振荡器。如果设备运行RF收发器，必须使用32 MHz晶体振荡器。

**高频振荡器**

- **32 MHz****晶体振荡器**

- **16 MHz RC****振荡器**

  不准确，不能用于 RF 收发器运行

**低频振荡器**

- **32 kHz**晶体振荡器 

  32 kHz晶体振荡器运行在32.768 kHz，并为系统需要的时间精度提供一个稳定的时钟信号。

- **32 kHz RC**振荡器

  校准时，32 kHz RC振荡器运行在32.753 kHz。校准只能发生在32 MHz晶体振荡器使能的时候，32 kHz RC振荡器可以用于降低成本和电源消耗。

##### 10. 配置外部中断

1\. 什么是中断？

所谓中断，是指 CPU 在正常执行程序的过程中，由于内部或外部事件的触发或由程序的预先安排，引起 CPU 暂时中断当前正在运行的程序，而转去执行为内部或外部事件或程序预先安排的事件的服务子程序

待中断服务子程序执行完毕后，CPU再返回到被暂时中断的程序处（断点）继续执行原来的程序。

CC2530 有18个中断源。每个中断源都有它自己的位于一系列 SFR 寄存器中的中断请求标志。相应标志位请求的每个中断可以分别使能或禁用。

通用 I/O 引脚在设置为输入后，可以用于产生中断。中断可以设置在外部信号的上升或下降沿触发。P0、P1和P2端口都有中断使能位，对位于IENl、IEN2寄存器内的端口所有的位都是公共的。如下：

- IEN1.P0IE：P0中断使能。
- IEN2.P1IE：P1中断使能。
- IEN2.P2IE：P2中断使能。

除了这些公共中断使能之外，每个端口的位都有位于SFR寄存器P0IEN、P1IEN和P2IEN的单独的中断使能。即使配置为外设I/O或通用输出的I/O引脚使能时，也能产生中断。

当中断条件发生在任意一个I/O引脚上时，P0～P2中断标志寄存器P0IFG、P1IFG或P2IFG中相应的中断状态标志将设置为1。不管引脚是否设置了它的中断使能位，中断状态标志都被设置。当中断已经执行，中断状态标志被清除，该标志写入0。这个标志必须在清除CPU端口中断标志（PxIF）之前被清除。

- P0IEN：P0中断使能。
- P1IEN：P1中断使能。
- P2IEN：P2中断使能。
- PICTL：P0、P1和P2触发沿设置。
- P0IFG：P0中断标志。
- P1IFG：P1中断标志。
- P2IFG：P2中断标志。

中断配置

每个中断请求可以通过设置中断使能SFR寄存器的中断使能位IEN0、IEN1或IEN2使能或禁止。CPU的中断使能相对应的SFR寄存器

为了使能任一中断功能，应当采取下列步骤：

① 清除中断标志。

② 如果有，则设置SFR寄存器中对应的各中断使能位为1。

③ 设置寄存器IEN0、IEN1或IEN2中对应的中断使能位为1。

④ 设置IEN0中的EA位为1使能全局中断。

⑤ 在中断对应的向量地址上，运行该中断的服务程序。